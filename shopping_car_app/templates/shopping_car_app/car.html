<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
{% load static %}
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<script src="/static/js/jquery_1.8.js"></script>
    <script src="/static/js/jquery_cookie.js"></script>
	<link rel="shortcut icon" href="/static/images/favicon.ico?v=20160901" type="image/x-icon">
    <link href="/static/css/shopping_cart_new.css" rel="stylesheet" type="text/css">
	<link href="/static/css/footer_150526.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/bootstrap.min.css" type="text/css" />
</head>

<body style="padding-bottom:82px">

<link href="/static/css/header_960_150611.css" rel="stylesheet" type="text/css">
<script src="/static/js/pagetop2015_0827.js" charset="gb2312" type="text/javascript"></script>

<div id="hd">
<div id="tools">
<div class="tools">
    <div class="ddnewhead_operate" dd_name="顶链接">
        
        <div class="ddnewhead_welcome" display="none;">
            {#   判断是否登录#}
            {% if userobj %}
                <span id="nickname_login">
                欢迎登陆：{{ userobj.user_name }}|
                <a href="{% url 'loginapp:login_status_exit' %}">登出</a>
                </span>
            {% else %}
                <span id="nickname">
                    <span class="hi hi_none">欢迎光临当当，请</span>
                    <a href="{% url 'loginapp:login_view' %}?status=2" class="login_link">登录</a><a href="{% url 'loginapp:register_view' %}?status=2">免费注册</a>
                </span>
            {% endif %}
            <div class="tel_pop" style="display:none" id="__ddnav_sjdd" onmouseover="showgaoji('a_phonechannel','__ddnav_sjdd');" onmouseout="hideotherchannel('a_phonechannel','__ddnav_sjdd');">
                <a target="_blank" href="http://t.dangdang.com/20130220_ydmr" class="title"><i class="icon_tel"></i>手机当当</a><i class="title_shadow"></i>
                <ul class="tel_pop_box">
                    <li><a href="http://t.dangdang.com/20130220_ydmr" dd_name="手机二维码"><span>当当手机客户端</span><img src="http://img3.ddimg.cn/00363/doc/erweima2.png"><span class="text">随手查订单<br>随时享优惠</span></a></li>
                </ul>
            </div>
        </div>
        <div class="new_head_znx" id="znx_content" style="display:none;"></div>
    </div>
</div>
</div>
<div id="header_end"></div>
<!--CreateDate  2016-09-28 11:30:01--></div>
<form action="http://search.dangdang.com/search.aspx" id="bootpagetopSearch" name="bootpagetopSearch" method="GET"></form>
<script type="text/javascript">var nick_num = 0;initHeaderOperate();</script><script type="text/javascript" src="http://orderb.dangdang.com/queryunpaid?callback=Unpaid_Data"></script>
		<div class="shoppingcart_wrapper" id="ad_cpt_11850"><div><a href="http://a.dangdang.com/tjump.php?q=ddo84XQOf357bOs8tXGg5%2F%2F0oVoDImt3DFWsMqu7ZMSVsfUMeOQJueASNiMLjq%2FdrXMLCKnVfyKEahteAh1ih%2ByKYrKGzhvL20LVbDzObRambBA0YPpivy5hR5foQ4Rt%2BTB" target="_blank" rel="nofollow"><img src="http://img62.ddimg.cn/2017/1/11/2017011111344969879.jpg"></a></div></div>
<div class="logo_line">
    <div class="w960">
        <div class="shopping_procedure"><span class="current">我的购物车</span><span>填写订单</span><span>完成订单</span></div>
        <div class="logo"><a href="#"><img src="/static/images/bz_logo_car.jpg" alt=""></a></div>
    </div>
</div>
<div class="add_line" id="district">
    <div class="w960">
        <div class="address" id="dp_adress">
            <span class="icon_adr">&nbsp;</span>配送地址：
            <div class="select_add">
                <span class="text fn-select-address">北京市东城区</span>
                <div class="area_pop" style="display:none;">
                    <a href="javascript:district.close()" class="close"></a>
                    <ul class="tab">
                        <li id="ap_province" class="fn-show-province"><a href="javascript:void(0)" id="selected_111">北京</a></li>
                        <li id="ap_city" class="fn-show-city"><a href="javascript:district.show_city_init(this)" id="selected_1">北京市</a></li>
                        <li id="ap_area" class="fn-show-area choose"><a href="javascript:district.show_area_init(this)" id="selected_1110101">东城区</a></li>
                        <li id="ap_village" style="display:none" class="fn-show-village"><a href="javascript:district.show_village_init(this)" id="selected_-1">请选择</a></li>
                    </ul>
                    <ul class="list list_notaligned fn-adress">

                    </ul>
                </div>
            </div>
            <!--<a href="#" class="tip"></a>-->
            <span class="tip_c" style="display:none;">针对不同配送地址，您的货物可能出现缺货或无货状态，敬请谅解。</span>
        </div>
    </div>
</div>
<div class="w960" id="showTip">


	<!-- 结算时 商品SPU限购提示窗口 start-->
	<div id="spuPromoLimitDiv" class="pop" style="left:50%; top:50%; margin:-200px 0 0 -253px; position: fixed; z-index: 1004; display: none;">
		<a class="close"></a>
		<div class="pop_title">商品限购</div>
		<div class="popup_limit"></div>
		<div class="btn_bar limit_bar">
			<a class="btn_red">确定</a><a class="pop_btn">取消</a>
		</div>
	</div>
	<!-- 结算时 商品SPU限购提示窗口 end-->
	

	<div id="giftDiv" class="pop_tip gift_select" style="left:50%; top:50%; margin:-200px 0 0 -302px; position: fixed; z-index: 1001; display: none;">
		<div class="head_title">
			<div class="title_name">您购物车中以下商品可选为赠品</div>
			<div class="close"></div>
		</div>
		<div class="products_sort" id="giftArea">
			
		</div>
		<a href="javascript:void(0)" class="btn_b fn-back-cart">返回购物车选赠品</a><a id="gift_checkout" href="#" class="btn_b">继续结算，土豪任性不要了</a>
	</div>
	<div class="login_tip" style="display: none;">
		<span class="icon"></span>
	</div>
	<div id="remove_pop" class="login_tip" style="display: none;">
		<span class="icon"></span>
	</div>
	<div id="clear_pop" class="login_tip" style="display: none;">
		<span class="icon"></span>
	</div>
</div>
<div class="w960" id="cart">
    <ul class="shopping_title" id="j_carttitle">
        <li class="f1"><a id="j_selectall" href="javascript:void(0)" class="checknow fn-checkall check_on" dd_name="全选">选中</a>全选</li>
        <li class="f2">商品信息</li>
        <li class="f3">单价（元）</li>
        <li class="f4">数量</li>
        <li class="f4">金额（元）</li>
        <li class="f5">操作</li>
    </ul>



    <div class="fn-shops" id="J_cartContent"><div class="fn-shop">
        <table border="0" cellspacing="0" cellpadding="0" class="shop_title">
            <tbody>
                <tr>
                    <td><a href="javascript:void(0)" dd_name="选中店铺" class="checknow fn-shop-checkall check_on">选中</a></td>
                    <td><span class="shop_icon"></span></td>
                    <td><a href="http://www.dangdang.com" target="_blank">当当自营</a></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>

{#商品列表#}
    {% if shop_car_obj %}
        <div class="shopping_list">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                {% for i in shop_car_obj.book_list %}
                    {% if i.bookCount > 0 %}

                        <tbody data-stock="22388" data-offline="false" data-productid="24147882" data-timestamp="1484488454000" data-orderforspupormo="0" id="disappare{{ i.book.id }}" class="hhh">

                            <tr id="tr_424893864" class="  "> <td class="row1"> <a href="javascript:void(0)" data-item="424893864" class="fn-product-check checknow check_on">选中</a> </td>
                                <td class="row_img"> <a href="http://product.dangdang.com/24147882.html" target="_blank" dd_name="查看详情">
                                    <img onmouseout="$(this).parent().next().hide()" onmouseover="$(this).parent().next().show()" src="/static/{{ i.book.product_image_path }}" width="80" height="80"> </a>
                                        <div style="display: none;" class="img_big"><a href="http://product.dangdang.com/24147882.html" dd_name="查看详情" target="_blank">
                                            <img src="/static/{{ i.book.product_image_path }}" id="book_pic{{ i.book.id }}">
                                            </a><span class="arrow"></span></div>
                                </td>
                                <td class="row_name">
                                    <div class="name">
                                        <a href="http://product.dangdang.com/24147882.html" title="跟乐嘉学性格色彩2（乐嘉2017年全新力作）" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;" id="book_name">{{ i.book.book_name }}</a>
                                    </div>      </td>
                                <td class="row3">¥<span id="book_dprice{{ i.book.id }}">{{ i.book.book_dprice }}</span></td>
                                <td data-minbuy="0" class="fn-count-tip row3 ">
                                    <span class="amount fn-updatecount " data-value="1">
                                        <a dd_name="减少数量" href="javascript:void(0)" onclick="check_add_count({{ i.book.id }},-1)">-</a>
                                        <input data-value="1" value="{{ i.bookCount }}" type="text" id="count_add_reduce{{ i.book.id }}" onblur="check_change_count({{ i.book.id }})" name="{{ i.book.book_price }}">
                                        <a dd_name="增加数量" href="javascript:void(0)" onclick="check_add_count({{ i.book.id }},1)" >+</a>
                                    </span>
                                </td>
                                <td class="row4">¥<span class="red book_total_price" id="book_total_price{{ i.book.id }}">{% widthratio i.book.book_dprice 1 i.bookCount %}</span></td>
                                <td class="row5 "><span><a href="javascript:void(0)" data-item="424893864" class="fn-add-wish" dd_name="加入收藏按钮">移入收藏</a></span><span><a href="javascript:void(0)" data-item="424893864" class="fn-remove-product" dd_name="删除普通品" onclick="del_book({{ i.book.id }})">删除</a></span></td>
                            </tr>
                        </tbody>
                    {% else %}
                         <tbody style="display: none" data-stock="22388" data-offline="false" data-productid="24147882" data-timestamp="1484488454000" data-orderforspupormo="0" id="disappare{{ i.book.id }}">

                            <tr id="tr_424893864" class="  "> <td class="row1"> <a href="javascript:void(0)" data-item="424893864" class="fn-product-check checknow check_on">选中</a> </td>
                                <td class="row_img"> <a href="http://product.dangdang.com/24147882.html" target="_blank" dd_name="查看详情">
                                    <img onmouseout="$(this).parent().next().hide()" onmouseover="$(this).parent().next().show()" src="/static/{{ i.book.product_image_path }}" width="80" height="80"> </a>
                                        <div style="display: none;" class="img_big"><a href="http://product.dangdang.com/24147882.html" dd_name="查看详情" target="_blank">
                                            <img src="/static/{{ i.book.product_image_path }}" id="book_pic{{ i.book.id }}">
                                            </a><span class="arrow"></span></div>
                                </td>
                                <td class="row_name">
                                    <div class="name">
                                        <a href="http://product.dangdang.com/24147882.html" title="跟乐嘉学性格色彩2（乐嘉2017年全新力作）" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;" id="book_name">{{ i.book.book_name }}</a>
                                    </div>      </td>
                                <td class="row3">¥<span id="book_dprice{{ i.book.id }}">{{ i.book.book_dprice }}</span></td>
                                <td data-minbuy="0" class="fn-count-tip row3 ">
                                    <span class="amount fn-updatecount " data-value="1">
                                        <a dd_name="减少数量" href="javascript:void(0)" onclick="check_add_count({{ i.book.id }},-1)">-</a>
                                        <input data-value="1" value="{{ i.bookCount }}" type="text" id="count_add_reduce{{ i.book.id }}" onblur="check_change_count({{ i.book.id }})" name="{{ i.book.book_price }}">
                                        <a dd_name="增加数量" href="javascript:void(0)" onclick="check_add_count({{ i.book.id }},1)" >+</a>
                                    </span>
                                </td>
                                <td class="row4">¥<span class="red book_total_price" id="book_total_price{{ i.book.id }}">{% widthratio i.book.book_dprice 1 i.bookCount %}</span></td>
                                <td class="row5 "><span><a href="javascript:void(0)" data-item="424893864" class="fn-add-wish" dd_name="加入收藏按钮">移入收藏</a></span><span><a href="javascript:void(0)" data-item="424893864" class="fn-remove-product" dd_name="删除普通品" onclick="del_book({{ i.book.id }})">删除</a></span></td>
                            </tr>
                        </tbody>

                    {% endif %}

                {% endfor %}

                <tfoot>
                    <tr class="total">
                        <td class="row1">&nbsp;</td>
                        <td class="row_img">店铺合计</td>
                        <td colspan="2">&nbsp;</td>
                        <td colspan="3" class="row4">¥<span class="red big ooline alignright" id="price_all">{{ shop_car_obj.total_price }}</span></td>
                    </tr></tfoot>

            </table></div><div class="shipping_add" style="display:none;"></div></div></div>
    {% else %}
        <div class="h3"></div>
        <div><h1>购物车空空如也</h1><a href="{% url 'mainapp:index' %}"><button class="total_btn fn-checkout" value="返回购物">返回购物</button></a></div>
    {% endif %}



    <div class="shoppingcart_loading" id="J_cartLoading" style="display: none;"><img height="30" width="30" src="/static/images/loading.gif"></div>
</div>
<div class="w960" id="weipinboxarea" style="display: none"><div class="login_tip"><span class="icon"></span>购物车中有<a id="weipinhui" href="http://v.dangdang.com" class="icon_eve weipin" style="display: none;">尾品汇</a><a id="zuizhidang" href="http://z.dangdang.com" class="icon_eve zhidang" style="display: none;">z值当</a>商品，请在<span class="time" id="J_limitedMinute"></span><span class="time" id="J_limitedSecond"></span>内结算.<a herf="javascript:;" class="more fn-vnewz-tips">了解限时结算&gt;&gt;</a></div></div>
<div id="hide_div" style="height:0px;visibility:hidden;"></div>
<div style="position:static;bottom:-20px;z-index: 101;width:100%;left:0px;">
  <div class="shopping_total" id="J_totalMoneyBlock">
    <div class="shopping_total_right">
        {% if shop_car_obj %}
        <a class="total_btn fn-checkout" href="{% url 'shopping_car_app:customer_sure_view' %}" id="checkout_btn" dd_name="结算">结&nbsp;&nbsp;算</a>
        {% else %}
        <a class="total_btn fn-checkout" href="{% url 'mainapp:index' %}" id="checkout_btn" dd_name="结算">返回&nbsp;&nbsp;购物</a>
        {% endif %}
        <div class="subtotal">
            <p><span class="cartsum">总计(不含运费)：</span><span id="payAmount" class="price">¥{{ shop_car_obj.total_price }}</span></p>

            <p><span class="cartsum">已节省：¥</span><span id="totalFavor">{{ shop_car_obj.save_price }}</span></p>

        </div>


        <div class="pop_del pop_ebook fn-ck" id="ck_tip" style="display:none">
			<h1>电子书重复购买提示</h1>
			<p></p>
			<a id="ck_link" href="#" class="pop_btn">朕知道了</a>
		</div>
    </div>
    <div class="shopping_total_left" id="J_leftBar">
        <a id="j_selectall2" href="javascript:void(0)" class="checknow fn-checkall check_on" dd_name="全选">选中</a>全选
        <a id="j_removeproducts" href="javascript:void(0)" class="fn-batch-remove" dd_name="批量删除按钮">批量删除</a>
        <span>已选择<font color="red">2</font>件商品</span>
        <div id="J_batchRemoveProductBox" style="display: none;z-index:-1;left:0px;" class="pop_del"><p>您确定要批量删除商品吗？</p><a href="javascript:;" class="pop_btn fn-confirm-batchremovebox">确定</a><a href="javascript:;" class="pop_btn fn-close-batchremovebox">取消</a></div>
        <div id="J_batchAddWishBox" style="display: none;z-index:-1;left:85px;" class="pop_del col "><p>您确定要批量移入收藏吗？</p><a href="javascript:;" class="pop_btn fn-confirm-batchaddwish">确定</a><a href="javascript:;" class="pop_btn fn-close-batchwishbox">取消</a></div>
    </div>
  </div>
</div>
<div id="J_errorBox" style="display: none;z-index:102" class="pop_del col">
    <p></p>
    <a class="pop_btn fn-close-removebox" href="javascript:;">确定</a>
</div>
<div id="J_addToWishTipHtml" style="display: none; position: absolute;"></div>
<div id="J_addWishBox" style="display: none" class="pop_del col "><p>移入收藏后，将不在购物车显示，是否继续操作？</p><a href="javascript:;" class="pop_btn fn-confirm-addwish">确定</a><a href="javascript:;" class="pop_btn fn-close-wishbox">取消</a></div>
<div id="J_removeProductBox" style="display: none;" class="pop_del"><p>您确定要删除商品吗？</p><a href="javascript:;" class="pop_btn fn-confirm-removebox">确定</a><a href="javascript:;" class="pop_btn fn-close-removebox">取消</a></div>
<div id="J_removeGiftBox" style="display: none;" class="pop_del"><p>您确定要删除赠品吗？</p><a href="javascript:;" class="pop_btn fn-confirm-removegiftbox">确定</a><a href="javascript:;" class="pop_btn fn-close-removebox">取消</a></div>
 <div class="fn-shops" id="J_cartContent"><div class="fn-shop">
        <table border="0" cellspacing="0" cellpadding="0" class="shop_title">
            <tbody>
                <tr>
                    <td><a href="javascript:void(0)" dd_name="选中店铺" class="checknow fn-shop-checkall check_on">选中</a></td>
                    <td><span class="shop_icon"></span></td>
                    <td><a href="http://www.dangdang.com" target="_blank">删除列表</a></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>

{#删除商品列表#}
        <div class="shopping_list" style="margin-left:200px">
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                {% for i in shop_car_obj.book_list %}

                        <tbody data-stock="22388" data-offline="false" style="display: none" data-productid="24147882" data-timestamp="1484488454000" data-orderforspupormo="0" id="disappare1{{ i.book.id }}">
                            <tr id="tr_424893864" class="  "> <td class="row1"> <a href="javascript:void(0)" data-item="424893864" class="fn-product-check checknow check_on">选中</a> </td>
                                <td class="row_img"> <a href="http://product.dangdang.com/24147882.html" target="_blank" dd_name="查看详情">
                                    <img onmouseout="$(this).parent().next().hide()" onmouseover="$(this).parent().next().show()" src="/static/{{ i.book.product_image_path }}" width="80" height="80"> </a>
                                        <div style="display: none;" class="img_big"><a href="http://product.dangdang.com/24147882.html" dd_name="查看详情" target="_blank">
                                            <img src="/static/{{ i.book.product_image_path }}" id="book_pic{{ i.book.id }}">
                                            </a><span class="arrow"></span></div>
                                </td>
                                <td class="row_name">
                                    <div class="name">
                                        <a href="http://product.dangdang.com/24147882.html" title="跟乐嘉学性格色彩2（乐嘉2017年全新力作）" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;" id="book_name">{{ i.book.book_name }}</a>
                                    </div>      </td>
                                <td class="row3">¥<span id="book_dprice{{ i.book.id }}">{{ i.book.book_dprice }}</span></td>
                                <td data-minbuy="0" class="fn-count-tip row3 ">
                                    <span class="amount fn-updatecount " data-value="1">
                                        <a dd_name="减少数量" href="javascript:void(0)" >-</a>
                                        <input data-value="1" value="{{ i.bookCount }}" type="text" id="count_add_reduce{{ i.book.id }}" onblur="check_change_count({{ i.book.id }})" name="{{ i.book.book_price }}">
                                        <a dd_name="增加数量" href="javascript:void(0)"  >+</a>
                                    </span>
                                </td>
                                <td class="row4">¥<span class="red book_total_price" id="book_total_price{{ i.book.id }}">{% widthratio i.book.book_dprice 1 i.bookCount %}</span></td>
                                <td class="row5 "><span><a href="javascript:void(0)" data-item="424893864" class="fn-add-wish" dd_name="加入收藏按钮">移入收藏</a></span><span><a href="javascript:void(0)" data-item="424893864" class="fn-remove-product" dd_name="删除普通品" onclick="find_book({{ i.book.id }})">恢复</a></span></td>
                            </tr>
                        </tbody>



                {% endfor %}
                 {% for i in shop_car_obj.book_list %}
                    {% if i.bookCount == 0 %}
                        <tbody data-stock="22388" data-offline="false" data-productid="24147882" data-timestamp="1484488454000" data-orderforspupormo="0" id="disappare2{{ i.book.id }}">
                            <tr id="tr_424893864" class="  "> <td class="row1"> <a href="javascript:void(0)" data-item="424893864" class="fn-product-check checknow check_on">选中</a> </td>
                                <td class="row_img"> <a href="http://product.dangdang.com/24147882.html" target="_blank" dd_name="查看详情">
                                    <img onmouseout="$(this).parent().next().hide()" onmouseover="$(this).parent().next().show()" src="/static/{{ i.book.product_image_path }}" width="80" height="80"> </a>
                                        <div style="display: none;" class="img_big"><a href="http://product.dangdang.com/24147882.html" dd_name="查看详情" target="_blank">
                                            <img src="/static/{{ i.book.product_image_path }}" id="book_pic{{ i.book.id }}">
                                            </a><span class="arrow"></span></div>
                                </td>
                                <td class="row_name">
                                    <div class="name">
                                        <a href="http://product.dangdang.com/24147882.html" title="跟乐嘉学性格色彩2（乐嘉2017年全新力作）" target="_blank" dd_name="查看详情" style="word-break:break-all;  word-wrap:break-word;" id="book_name">{{ i.book.book_name }}</a>
                                    </div>      </td>
                                <td class="row3">¥<span id="book_dprice{{ i.book.id }}">{{ i.book.book_dprice }}</span></td>
                                <td data-minbuy="0" class="fn-count-tip row3 ">
                                    <span class="amount fn-updatecount " data-value="1">
                                        <a dd_name="减少数量" href="javascript:void(0)" >-</a>
                                        <input data-value="1" value="{{ i.bookCount }}" type="text" id="count_add_reduce{{ i.book.id }}" onblur="check_change_count({{ i.book.id }})" name="{{ i.book.book_price }}">
                                        <a dd_name="增加数量" href="javascript:void(0)"  >+</a>
                                    </span>
                                </td>
                                <td class="row4">¥<span class="red book_total_price" id="book_total_price{{ i.book.id }}">{% widthratio i.book.book_dprice 1 i.bookCount %}</span></td>
                                <td class="row5 "><span><a href="javascript:void(0)" data-item="424893864" class="fn-add-wish" dd_name="加入收藏按钮">移入收藏</a></span><span><a href="javascript:void(0)" data-item="424893864" class="fn-remove-product" dd_name="删除普通品" onclick="find_a_book({{ i.book.id }})">恢复</a></span></td>
                            </tr>
                        </tbody>

                    {% endif %}

                {% endfor %}
                <tfoot>
                    <tr class="total">
                        <td class="row1">&nbsp;</td>
                        <td class="row_img">店铺合计</td>
                        <td colspan="2">&nbsp;</td>
                        <td colspan="3" class="row4">¥<span class="red big ooline alignright" id="">0</span></td>
                    </tr></tfoot>

            </table></div><div class="shipping_add" style="display:none;"></div></div></div>
<div class="" style="margin-left:200px">
    <div>删除列表</div>
    <table class=".table table-striped .table-bordered">
        <div class="row">
            <ul class="shopping_title" id="j_carttitle">
            <div class=""><li class="f1">图片</li></div>
            <div class="">
                <li class="f2">商品信息</li>
            </div>
            <div class="">
                <li class="f3">单价（元）</li>
            </div>
            <div class="">
                <li class="f4">数量</li>
            </div>
            <div class="">
                <li class="f4">金额（元）</li>
            </div>
            <div class=""><li class="f5">操作</li>
            </div>
                  </ul>
        </div>

    <span id="delete_table">

    </span>
    </table>
</div>
<div class="w960">
    <div class="empty" id="empty" style="display:none">
        <p>您的购物车还是空的，您可以：</p>
        <a href="http://www.dangdang.com" class="btn">去逛逛</a>
    </div>
    
</div>

<div class="pop_del pop_ebook" style="left:460px; right:auto; top:-130px;display: none;" id="J_vnewzTipBox">
	<a href="#" class="close"></a>
	<h1>限时说明</h1>
	<p>由于尾品会和新品汇的商品库存有限，我们只能为您保留<span class="red">20分钟</span>，否则尾品会及新品汇的商品将被删除，请尽快结算。</p>
</div>




<div id="footer">
<div class="footer">
	<div class="footer_nav_box">
		<div class="footer_copyright"><span>Copyright (C) 当当网 2004-2014, All Rights Reserved</span><a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001051000098" target="_blank" class="footer_img" rel="nofollow"><img src="http://img4.dangdang.com/bottom/validate.gif"></a><span><a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">京ICP证041189号</a></span><span>出版物经营许可证&nbsp;新出发京批字第直0673号</span></div>
	</div>
</div>
</div>
    <div class="foot_tip_ad">广告</div>
    <style>
        .foot_tip_ad { width:40px; height:40px; font:12px/40px "simsun"; text-align:center; color:#fff; background-color:#474747; position:fixed; right:0; bottom:10px;_position:absolute; _bottom:auto;_top:expression(eval(document.documentElement.scrollTop+document.documentElement.clientHeight-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0)));}
    </style>


</body>
<script src="/static/js/jquery-3.3.1.min.js"></script>
<script>
{#    删除列表#}
    var list_del_all=new Array();
    {#    ajax设置请求头#}
    $.ajaxSetup({
        headers:{"X-CSRFToken":'{{ csrf_token }}'},
    });
{#    添加减少一本书#}
    function check_add_count(book_id,book_count_add) {
{#        数量+1#}
        var str1="#count_add_reduce"+book_id;
{#        转换字符串为int#}
        var book_count=Number($(str1).val());
        //数量判断
        if (book_count>=1 || book_count_add>0){
            book_count=book_count+book_count_add;
            $(str1).val(book_count);

        change_other_price(book_id);
    {#        ajax添加jian减少#}
            $.ajax({
                        type:'POST',
                        url:"{% url 'shopping_car_app:add_book_into_car' %}",
                        data:'bookId='+book_id+'&bookCount='+book_count_add,
                        success:function (msg) {
                            console.log(msg)
                        }
            })

        }
    }
{#在文本框改数量#}
    function check_change_count(book_id){
        var str1="#count_add_reduce"+book_id;
        {#        转换字符串为int#}
        var book_count=Number($(str1).val());
        //判断是否为正数
        if(book_count>0){
            console.log(book_count)
        }else {
            console.log(1);
{#            如果不是正整数，数量为1#}
             book_count=1;
            $(str1).val(book_count);
        }
        change_other_price(book_id);
{#      ajax添加减少#}
            $.ajax({
                        type:'POST',
                        url:"{% url 'shopping_car_app:change_book_into_car' %}",
                        data:'bookId='+book_id+'&bookCount='+book_count,
                        success:function (msg) {
                            console.log(msg)
                        }
            })
    }
{#    通过bookId和数量改变金额#}
    function change_other_price(bookId) {
{#        一本书价格#}
        var price_book=Number($('#count_add_reduce'+bookId).attr('name'));
{#        之前节省的总价#}
        var before_save_price=Number($('#totalFavor').html());

        //当当价
        var book_dprice=$('#book_dprice'+bookId).html();

        //书数量
        var book_count=$('#count_add_reduce'+bookId).val();
        //之前单本总价格
        var before_price=Number($("#book_total_price"+bookId).html());
//单本总价格：
        var book_price_one= Number(book_dprice)*Number(book_count);
        console.log(book_price_one);
        $("#book_total_price"+bookId).html(book_price_one);
{#        获得所有的书总价格#}
        var total_price=Number($("#price_all").html())+book_price_one-before_price;
{#        判断书增加减少#}
{#        一本书节省价#}
        var save_one_price=price_book-book_dprice;
        console.log(save_one_price,price_book,book_dprice);
        if(book_price_one-before_price>0){
            before_save_price=before_save_price+save_one_price;
        }else {
            before_save_price=before_save_price-save_one_price
        }
        $('#totalFavor').html(before_save_price);
        $("#price_all").html(total_price);
        $("#payAmount").html(total_price);




    }

{#    删除书#}
    function del_book(book_id) {

{#        {{ i.book.id }},{{ i.book.book_name }},{{ i.book.book_dprice }}#}
        {#        ajax添加jian减少#}
        var book_name=$("#book_name").html();
        //当当价

        var price_one=$("#book_dprice"+book_id).html();
        //获得书总价
        var total_price=Number($("#price_all").html());
        console.log(total_price);
        //获得书数量
        var book_count=Number($('#count_add_reduce'+book_id).val());
        console.log(book_count);
        //单本书总价
        var price_all=book_count*price_one;
                {#        一本书价格#}
        var price_book_before=Number($('#count_add_reduce'+book_id).attr('name'));
{#        单本书节省价格#}
        var one_save_price=(price_book_before-price_one)*book_count;
        var save_all_before=Number($('#totalFavor').html());
        //节约的总价格
        $('#totalFavor').html(save_all_before-one_save_price);
        //路径
        var path_pic=$("#book_pic"+book_id).attr('src');

        //改变总价
        total_price=total_price-price_all;
        console.log(total_price,price_all)
        $("#payAmount").html(total_price);
        $("#price_all").html(total_price);

        //建立存储数组
        var list_one=new Array(book_id,book_name,price_one,book_count,price_all,path_pic);
        list_del_all.push(list_one);
        //隐藏已删
        $("#disappare"+book_id).css('display','none');
        $("#disappare1"+book_id).css('display','');
{#        $("#disappare"+book_id).show().delay(100).hide(300);#}
        var strs;
        for(i=0;i<list_del_all.length;i++){
            var count= list_del_all[i][0];
            var str1="/car/find_book/?bookId="+count;
{#            strs+='<ul class="shopping_title" id="">'+#}
{#                '<li class="f1"><img height="30px" width="30px" src="'+list_del_all[i][5]+'"></li> ' +#}
{#                '<li class="f2">'+list_del_all[i][1]+'</li> ' +#}
{#                '<li class="f3">'+list_del_all[i][2]+'</li> ' +#}
{#                '<li class="f4">'+list_del_all[i][3]+'</li> ' +#}
{#                '<li class="f4">'+list_del_all[i][4]+'</li>' +#}
{#                ' <li class="f5" style="">'+'<a href='+str1+'>'+'恢复'+'</a>'+'</li>'+#}
{#                '</ul>';#}
        };
{#        $("#delete_table").html(strs);#}
        $.ajax({
                    type:'POST',
                    url:"{% url 'shopping_car_app:delete_book' %}",
                    data:'bookId='+book_id,
                    success:function (msg) {
                        console.log(msg)
                    }
        });
    }
{#    找回书#}
    function find_book(book_id) {
        $("#disappare"+book_id).css('display','');
        $("#disappare1"+book_id).css('display','none');
        //当当价

        var price_one=$("#book_dprice"+book_id).html();
        //获得书总价
        var total_price=Number($("#payAmount").html());
        //获得书数量
        var book_count=Number($('#count_add_reduce'+book_id).val());
        console.log(book_count)
        //单本书总价
        var price_all=book_count*price_one;
        //改变总价
        $("#payAmount").html(total_price+price_all);
        $("#price_all").html(total_price+price_all);
                  {#        一本书价格#}
        var price_book_before=Number($('#count_add_reduce'+book_id).attr('name'));
{#        单本书节省价格#}
        var one_save_price=(price_book_before-price_one)*book_count;
        var save_all_before=Number($('#totalFavor').html());
        //节约的总价格
        $('#totalFavor').html(save_all_before+one_save_price);
         $.ajax({
                    type:'POST',
                    url:"{% url 'shopping_car_app:find_book' %}",
                    data:'bookId='+book_id,
                    success:function (msg) {
                        console.log(msg)
                    }
        });
//添加一本书
{#        check_add_count(book_id,1);#}
    }
function find_a_book(book_id) {
{#    //添加一本书#}
        check_add_count(book_id,1);
                //隐藏已删
        $("#disappare"+book_id).css('display','');
        $("#disappare1"+book_id).css('display','none');
        $("#disappare2"+book_id).css('display','none');
}

</script>
</html>
